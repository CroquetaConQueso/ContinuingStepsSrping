<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Formulario</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link th:href="@{/css/estiloFormulario.css}" rel="stylesheet">
  </head>
  <body>
    <!--Para establecer que los datos van a ser tomados se ha de establecer th:action en el form. Especificando tambien que tipo de metodo va a ser(get,post,..)-->
    <!--Al establecer el th:object con usuario se puede mapear los valores a la clase pojo, en este caso a Usuario-->
    <div class="container">
    <form th:action="@{/formulario}" th:object="${usuario}" method="post">
      <div>
        <h1>Formulario</h1>
        <label for="nameUsuario">Nombre de Usuario</label>
        <div class="mb-3">
          <!--Para que no borre los datos que estamos enviando , debemos de establecer un value en el input, ya que si ocurre un error borraria todo(resetearia todo)-->
          <!--Esto equivale a tener value="${nombreVariable}"-->
          <input
            type="text"
            placeholder="Introduzca el nombre.."
            id="nameUsuario"
            th:field="*{nameUsuario}"
            class="form-control"
          />
          <!--Las referencias al th:object son con un * en vez de con un $-->
        </div>
        <!--Cuando queremos buscar el valor , debemos de recordar que es por la id la cual el objeto es reconocido.
        Al tener la anotacion @Valid, la clase volverá a ser pasada automáticamente. Por lo que podriamos volver el valor en el input tras este haya tomado o intentado tomar uno-->

        <!--Anteriormente el control de errores que tenia establecido necesitaba el paso del hashmap y 
        del tipo de error, si este tenia un valor el if se usaba pero existe una maneña en el que thymeleaf y 
        springboot en general automatiza esto. Por lo que el if de abajo va a ser comentado-->

        <!-- <div th:if="${error != null && error.containsKey('nameUsuario')}">
          <p th:text="${error.get('nameUsuario')}"></p>
        </div> 
        
        Y va a ser cambiado por:
        una referencia a fields con una referencia de uso # a un plural de errores y un th:errors el cual tiene una referencia al th:object-->
        <div
          th:if="${#fields.hasErrors('nameUsuario')}"
          th:errors="*{nameUsuario}"
        ></div>
      </div>
      <div class="mb-3">
        <label for="surnameUsuario">Apellido del Usuario</label>
        <div>
          <input
            type="text"
            placeholder="Introduzca los apellidos.."
            id="surnameUsuario"
            th:field="*{surnameUsuario}"
            class="form-control"
          />
        </div>
        <div
          th:if="${#fields.hasErrors('surnameUsuario')}"
          th:errors="*{surnameUsuario}"
        ></div>
      </div>
      <div class="mb-3">
        <label for="edadUsuario">Edad del Usuario</label>
        <div>
          <!--Si se establece como type="number", la validacion ocurre en el navegador y no en el servidor spring.-->
          <input
            type="text"
            placeholder="Introduzca la edad.."
            id="edadUsuario"
            th:field="*{edadUsuario}"
            class="form-control"
          />
        </div>
        <div
          th:if="${#fields.hasErrors('edadUsuario')}"
          th:errors="*{edadUsuario}"
        ></div>
      </div>
      <div class="mb-3">
        <label for="fechaNacimientoUsuario"
          >Fecha de Nacimiento del Usuario</label
        >
        <div>
          <input
            type="date"
            id="fechaNacimientoUsuario"
            th:field="*{fechaNacimientoUsuario}"
            class="form-control"
          />
        </div>
        <div
          th:if="${#fields.hasErrors('fechaNacimientoUsuario')}"
          th:errors="*{fechaNacimientoUsuario}"
        ></div>
      </div>
      <div class="mb-3">
        <label for="passwordUsuario">Contraseña del Usuario</label>
        <div>
          <input
            type="password"
            placeholder="Introduzca la contraseña.."
            id="passwordUsuario"
            th:field="*{passwordUsuario}"
            class="form-control"
          />
        </div>
        <div
          th:if="${#fields.hasErrors('passwordUsuario')}"
          th:errors="*{passwordUsuario}"
        ></div>
      </div>
      <div class="mb-3">
        <label for="emailUsuario">Email del Usuario</label>
        <div>
          <input
            type="email"
            placeholder="Introduzca el email del usuario"
            id="emailUsuario"
            th:field="*{emailUsuario}"
            class="form-control"
          />
        </div>
        <div
          th:if="${#fields.hasErrors('emailUsuario')}"
          th:errors="*{emailUsuario}"
        ></div>
      </div>
      <div class="mb-3">
        <label for="idUsuario">ID del Usuario</label>
        <div>
          <input
            type="text"
            placeholder="Introduzca el ID de usuario.."
            id="idUsuario"
            th:field="*{idUsuario}"
            class="form-control"
          />
        </div>
        <div
          th:if="${#fields.hasErrors('idUsuario')}"
          th:errors="*{idUsuario}"
        ></div>
      </div>
      <div class="mb-3">
        <label for="paisUsuario">Pais del Usuario</label>
        <div>
          <select id="paisUsuario" th:field="*{paisUsuario}" class="form-select">
            <!--Así es como se establece un valor por defecto en una opcion-->
            <option value="">--Seleccione el pais--</option>
            <!--Tenemos que tener en cuenta que siempre que se tome un valor(lo cual esta igualado por th:value), este va a 
        ser el unico valor tomado. En este caso, select siempre va a devolver un String, por lo que tendremos que jugar con
         la cadena para poder dividir varios valores y tomar todos estos a hacer splits de la cadena en si-->
            <option
              th:each="paisUsuario: ${listaPaises}"
              th:text="${paisUsuario.nombrePais}"
              th:value="${paisUsuario.idPais}"
            ></option>
          </select>
        </div>
        <div
          th:if="${#fields.hasErrors('paisUsuario')}"
          th:errors="*{paisUsuario}"
        ></div>
      </div>
      <!-- <div>
        <div>
        <label for="fondosUsuario">Fondos del Usuario</label>
        <input
          name="fondosUsuario"
          type="text"
          placeholder="Introduzca los fondos.."
          id="fondosUsuario"
        />
        </div> -->

      <div class="mb-3">
        <label class="form-label fw-bold">Rol Del Usuario</label>
        <!--Para hacer un for de un checkbox se debe de hacer con aterioridad comparado con por ejemplo un select y en un div en vez de en un option-->
        <div th:each="rol: ${listaRoles}" class="form-check">
          <input class="form-check-input" type="checkbox" th:field="*{rolesUsuario}" th:value="${rol.idRol}"/>
          <!--
          th:for NO itera; lo que hace es establecer dinámicamente el atributo "for" del <label>.
          En este caso se usa junto con #ids.prev('rolesUsuario') para enlazar este label al último
          <input> generado por th:field="*{rolesUsuario}" en la iteración. 
          Gracias a esto, al hacer clic en el texto del label se marca/desmarca el checkbox correspondiente.
          -->
          <label class="form-check-label" th:for="${#ids.prev('rolesUsuario')}" th:text="${rol.nombreRol}"></label>
        </div>
        <div
          th:if="${#fields.hasErrors('rolesUsuario')}"
          th:errors="*{rolesUsuario}"
        >
      </div>
      <div class="mb-3">
        <label class="form-label d-block fw-bold mb-2">Genero Del Usuario</label>
        <div th:each="gen : ${listaGeneros}" class="form-check form-check-inline">
          <!--Como son dos botones, deben de tener dos ids diferentes-->
          <input type="radio" th:field="*{generoUsuario}" th:value="${gen}" class="form-check-input">
          <label th:for="${#ids.prev('generoUsuario')}" th:text="${gen}" class="form-check-label"></label>
        </div>
        <div th:if="${#fields.hasErrors('generoUsuario')}" th:errors="*{generoUsuario}">
        </div>
      </div>
      <!--Esto establece un valor secreto en el formulario el cual no se muestra pero se toma en consideracion-->
      <div>
        <input type="hidden" id="secretoUsuario" th:field="*{secretoUsuario}" >
      </div>
      <div>
        <input type="submit" value="Enviar" class="btn btn-primary"/>
      </div>
    </form>
  </div>
  </body>
</html>
